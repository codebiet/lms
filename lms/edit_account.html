<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Edit Account</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
        
        <script src="https://kit.fontawesome.com/5a27b7711c.js" crossorigin="anonymous"></script>
        
        <link rel="stylesheet" href="/path/to/dist/cropper.min.css" />
        <style>
            .image-container{
                max-width:70%;
                height:70%;
                position:relative;
            }
            #id_confirm{
                color:green;
            }
            #id_confirm:hover{
                opacity:0.3;
            }
            #id_cancel:hover{
                opacity:0.3
            }
             #id_cancel{
                color:red;
            }
            .material-icons{
                font-size:30px;
            }
            .material-icons:hover{
                cursor:pointer;
            }
        </style>
        
    </head>
    <body>
        <!--code-->
        <div class="container" id="id_loading_spinner" style="display:none">
            <div class="d-flex flex-row mx-auto flex-row-1 justify-content-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
        </div>
        
        
        
        
        <div class="mb-2" id="id_image_crop_confirm">
            <span id="id_cancel" class="material-icons">Cancel</span>
            <span id="id_confirm" class="material-icons">Check</span>
        </div>
       <div class="container-fluid mx-0 px-0" style="max-width: 100;">
           <img src="./img/bgcover.jpg" class="img-fluid mx-0 px-0" style="width: 100%; height: 250px; overflow-x: hidden;">
       </div>                
<div class="container-fluid" style="margin: 0;">
      <div class="row media">
         <div class="col-6 col-md-4 mt-2 text-center image-container" id="id_image_container" style="float: left; overflow-x: hidden;">
          
            <div class="image-container" id="id_image_container">
               <img class="mr-3 mt-3 border border-dark rounded-circle img-fluid mx-auto profile-image" id="id_profile_image" src="./img/bks.jpg" alt="image">
                <div class="middle" id="id_middle_container">
                    <div class="text" id="id_text">Edit</div>
                   </div>
            </div>
            
             <br><br><br><div>
            <button type="button" class="btn btn-outline-dark btn-block btn-lg mt-4"><strong>Change Password</strong></button>
            <button type="button" class="btn btn-outline-info btn-block btn-lg mt-4"><strong>Update Profile</strong></button>
            </div></div>
        <div class="col-12 col-md-8 my-5 media-body" style="overflow-x: hidden">
            <table class="table table-borderless table-md h5">
                <thead>
                    <tr>
                        <th scope="col" class="text-primary">NAME: </th>
                        <th scope="col" class="text-success"><input type="fullname" class"form-control" id="fullname" placeholder="Enter Full Name" required></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row" class="text-primary">ROLL NO.: </th>
                        <td class="text-success"><input type="rollno." class"form-control" id="rollno." placeholder="Enter Roll No." required></td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-primary">BRANCH: </th>
                        <td class="text-success"><div class="btn-group dropright">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown">Select
                             <span class="caret"></span></button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
    <a class="dropdown-item" href="#">CSE</a>
    <a class="dropdown-item" href="#">IT</a>
    <a class="dropdown-item" href="#">EE</a>
    <a class="dropdown-item" href="#">ECE</a>
    <a class="dropdown-item" href="#">CE</a>
    <a class="dropdown-item" href="#">ME</a>
    <a class="dropdown-item" href="#">CHE</a></div></div>


 </td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-primary">YEAR: </th>
                        <td class="text-success"><div class="btn-group dropright">
                    <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown">Select
                             <span class="caret"></span></button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
    <a class="dropdown-item" href="#">1</a>
    <a class="dropdown-item" href="#">2</a>
    <a class="dropdown-item" href="#">3</a>
    <a class="dropdown-item" href="#">4</a>
                </div></div></td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-primary">EMAIL ID: </th>
                        <td class="text-success"><input type="email" class"form-control" id="email" placeholder="Enter Email" required></td>
                    </tr>
                    <tr>
                        <th scope="row" class="text-primary">NO. OF BOOKS ISSUED: </th>
                        <td class="text-success"><input type="numofissuedbook" class"form-control" id="numofissuedbook" placeholder="Enter Number" required></td>
                    </tr>
                    <tr>
                        <th scope="row">
                            <a href="{% url 'issued_books' %}">
                                <button type="button" class="btn btn-outline-primary btn-lg mt-4"><strong>Issued Books</strong></button>
                            </a>
                        </th>
                        <td>
                            <button type="button" class="btn btn-outline-success btn-lg mt-4"><strong>Upload PDF</strong></button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div> 
       
    </div>
</div>
        
        <script type="text/javascript">
            var cropper;
            var imageFile;
            var base64ImageString;
            var cropX;
            var cropY;
            var cropWidth;
            var cropHeight;
            
            enableImageOverlay()
            
            function readURL(input){
                if(input.files && input.files[0]){
                    var reader = new FileReader()
                    reader.onload = function(e){
                        disableImageOverlay()
                        var image = e.target.result
                        var imageField = document.getElementById("id_image_profile_display")
                        imageField.src = image
                        cropper = new Cropper(imageField,{
                            aspectRatio : 1/1,
                            crop(event){
                                console.log("CROP START")
                                console.log("x: " + event.detail.x)
                                console.log("y: " + event.detail.y)
                                console.log("width: " + event.detail.width)
                                console.log("height: " + event.detail.height)
                                setImageCropProperties(
                                        image,
                                        event.detail.x,
                                        event.detail.y,
                                        event.detail.width,
                                        event.detail.height
                                )
                            }
                        })
                    }
                    
                    reader.readAsDataURL(input.files[0])
                }
               }
            function setImageCropProperties(image,x,y,width,height){
                imageFile = image
                cropX = x
                cropY = y
                cropWidth = width
                cropHeight = height
            }
            
            function isImageSizeValid(){
                var startIndex = image.indexOf("base64,")+7
                var base64str = image.substr(startIndex)
                var decoded = atob(base64str)
                if(decoded.length >= "{{DATA_UPLOAD_MAX_MEMORY_SIZE}}"){
                    return NULL
                }
                return base64str
            }
            
            function cropImage(image, x, y, width, height){
                base64ImageString = isImageSizeValid(image)
                if(base64ImageString != NULL){
                    var requestData = {
                        "csrfmiddlewaretoken" : "{{csrf_token}}",
                        "image" : base64ImageString,
                        "cropX" : cropX,
                        "cropY" : cropY,
                        "cropWidth" : width,
                        "cropHeight" : height,
                    }
                    displayLoadingSpinner(true)
                    $.ajax({
                        type : "POST",
                        dataType : "json",
                        url : "./img/bks.jpg"
                        data : requestData,
                        timeout : 10000,
                        success : function(data){
                            if(data.result == "success"){
                                document.getElementById("id_cancel").click()
                            }
                            else if(data.result == "error"){
                                alert(data.exception)
                                document.getElementById("id_cancel").click()
                            }
                        },
                        error : function(data){
                            console.log("ERROR...",data)
                        },
                        complete : function(data){
                           displayLoadingspinner(false) 
                        }
                    })
                }
                else{
                    alert("Upload an image smaller than 10MB!")
                    document.getElementById("id_cancel").click()
                }    
            }
            
            function enableImageOverlay(){
                var text = document.getElementById("id_text")
                text.style.backgroundColor = "#0066ff"
                text.style.color = "white"
                text.style.fontSize = "16px"
                text.style.padding = "16px 32px"
                text.style.cursor = "pointer"
                
                var profileImage = document.getElementById("id_profile_image")
                profileImage.style.opacity = "1"
                profileImage.style.display = "block"
                profileImage.style.width = "100%"
                profileImage.style.height = "auto"
                profileImage.style.transition = ".5s ease"
                profileImage.style.backfaceVisibility = "hidden"
                profileImage.style.cursor = "pointer"
                
                var middleContainer = document.getElementById("id_middle_container")
                //middleContainer.style.transition = ".5s ease"
                middleContainer.style.opacity = "0"
                middleContainer.style.position = "absolute"
                middleContainer.style.top = "50%"
                middleContainer.style.left = "50%"
                middleContainer.style.transform = "translaye(-50%,-50%)"
                
                var imageContainer = document.getElementById("id_image_container")
                imageContainer.addEventListener("mouseover",function(event){
                    profileImage.style.opacity = "0.3"
                    middleContainer.style.opacity = "1"
                })
                
                var imageContainer = document.getElementById("id_image_container")
                imageContainer.addEventListener("mouseout",function(event){
                    profileImage.style.opacity = "1"
                    middleContainer.style.opacity = "0"
                })
                
                var imageContainer = document.getElementById("id_image_container")
                imageContainer.addEventListener("click",function(event){
                    document.getElementById("id_profile_image").click()
                })
                
                var cropConfirm = document.getElementById("id_image_crop_confirm")
                cropConfirm.classList.remove("d-flex")
                cropConfirm.classList.remove("flex-row")
                cropConfirm.classList.remove("justify-content-between")
                cropConfirm.classList.add("d-none")
                
            }
            
            function disableImageOverlay(){
                var profileImage = document.getElementById("id_profile_image_display")
                var middleContainer = document.getElementById("id_middle_container")
                var imageContainer = document.getElementById("id_image_container")
                var text = document.getElementById("id_text")
                
                imageContainer.removeEventListener("mouseover",function(event){
                    profileImage.style.opacity = "0.3"
                    middleContainer.style.opacity = "1"
                })
                imageContainer.removeEventListener("mouseout",function(event){
                    profileImage.style.opacity = "1"
                    middleContainer.style.opacity = "0"
                })
                
                profileImage.style.opacity = "1"
                middleContainer.style.opacity = "0"
                text.style.cursor = "pointer"
                text.style.opacity = "0"
                
                imageContainer.removeEventListener("click",function(event){
                    //event.preventDefault()
                })
                document.getElementById("id_profile_image").addEventListener("click",function(event){
                    event.preventDefault()
                })
                
                var cropConfirm = document.getElementById("id_image_crop_confirm")
                cropConfirm.classList.add("d-flex")
                cropConfirm.classList.add("flex-row")
                cropConfirm.classList.add("justify-content-between")
                cropConfirm.classList.remove("d-none")
                
                var confirm = document.getElementById("id_confirm")
                confirm.addEventListener("click",function(event){
                    cropImage(image, cropX, cropY, cropWidth, cropHeight)
                })
                
                var cancel = document.getElementById("id_cancel")
                cancel.addEventListener("click",function(event){
                    console.log("reloading window...")
                    window.location.reload();
                })
            }
        </script>
        <script type="text/javascript">
            function displayLoadingSpinner(isdisplayed){
                var spinner = document.getElementById("id_loading_spinner")
                if(isDisplayed){
                    spinner.style.display ="block"
                    }
                else{
                      spinner.style.display = "none"  
                    }
                    
            }
            
            </script>
        
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <script type="module" src="/path/to/dist/cropper.min.js"></script>
    </body>
</html>
